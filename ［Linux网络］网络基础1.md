![在这里插入图片描述](https://img-blog.csdnimg.cn/bba080af95234416b4cdd78adb0e1fec.png)

@[TOC](文章目录)

# 计算机网络背景
## 网络背景

**1.独立模式：计算机之间相互独立。**
最初的计算机是相互独立的，各个计算机之间是无法交互的。
![在这里插入图片描述](https://img-blog.csdnimg.cn/b1ec656cbbb548629377838306cca849.png)

**2.网络互联：多台计算机连接在一起，完成数据共享。**
随着计算机的普及，流入高校等一些研究室，这些高校和研究室有数据研究和沟通的需求，这就诞生了网络，网络的诞生大大提高了效率。
![在这里插入图片描述](https://img-blog.csdnimg.cn/72e40ef16fda413b80feb9a7f0b6a8df.png)

**3.局域网LAN：计算机数量更多了, 通过交换机和路由器连接在一起。**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20784d1888dd4952b9a28e63fdfafab6.png)

**4.广域网WAN：将远隔千里的计算机都连在一起。**
![在这里插入图片描述](https://img-blog.csdnimg.cn/fb8ca81089874d0da4af3e53380266bc.png)

所谓 "局域网" 和 "广域网" 只是一个相对的概念。比如, 我们国家的广域网, 也可以看做一个比较大的局域网。

---

# 认识协议
协议是一种约定。


**感性认识协议：**

小明生活费紧缺，但是每天不得不和家里通电话。小明就和父亲约定：小明打电话给父亲，电话响一声就代表保平安；电话响两声就代表没有生活费；电话响三声就代表有要事沟通。**小明和父亲的约定就叫做协议。**

![在这里插入图片描述](https://img-blog.csdnimg.cn/18f7b8e662964593af94f2646270aeca.png)

---

# 网络协议初识

![在这里插入图片描述](https://img-blog.csdnimg.cn/e4b110551d434033b9dd6f1eaec3593a.png)

**计算机之间的传输媒介是光信号和电信号。通过 "频率" 和 "强弱" 来表示 0和1这样的信息。要想传递各种不同的信息，就需要约定好双方的数据格式。
计算机生产厂商有很多; 计算机操作系统, 也有很多; 计算机网络硬件设备, 还是有很多; 如何让这些不同厂商之间生产的计算机能够相互顺畅的通信?**

 就需要有人站出来, 约定一个共同的标准, 大家都来遵守, 这就是 **网络协议**。

---
## 协议分层
![在这里插入图片描述](https://img-blog.csdnimg.cn/f1106544341d494dbe128a4013921f43.png)
- **协议是分层的。就如上图人们沟通被分为语言层和通信设备层。更改语言层，两个人可以用英语协议用英语沟通一样可以正常通信。更改通信设备层，两个人可以用无线电协议用无线电一样可以正常通信。**
- **将协议分层，各层解耦，分层可以让比较复杂的网络协议更加简单化。分层将每个分层独立使用，即使系统的某些分层发生变化，也不会波及整个系统。**
 

---

# OSI七层模型

- **OSI（Open System Interconnection，开放系统互连）七层网络模型称为开放式系统互联参考模型**，是一个**逻辑上**的定义和规范;
- 把网络从逻辑上分为了7层. 每一层都有相关、相对应的物理设备，比如路由器，交换机;
- OSI 七层模型是一种框架性的设计方法，其最主要的功能使就是帮助不同类型的主机实现数据传输; 
- 它的最大优点是将**服务、接口和协议**这三个概念明确地区分开来，概念清楚，理论也比较完整. 通过七个层次化的结构模型使不同的系统不同的网络之间实现可靠的通讯;
- 但是, 它既复杂又不实用; 所以我们按照**TCP/IP四层模型来讲解**

![在这里插入图片描述](https://img-blog.csdnimg.cn/2bf0b56eba0045f1a1e49fc3f99e83d8.png)

---

# TCP/IP模型

**TCP/IP是一组协议的代名词，它还包括许多协议，组成了TCP/IP协议簇. 
TCP/IP通讯协议采用了5层的层级结构，每一层都呼叫它的下一层所提供的网络来完成自己的需求.**
- **物理层**: 负责光/电信号的传递方式. 比如现在以太网通用的网线(双绞 线)、早期以太网采用的的同轴电缆(现在主要用于有线电视)、光纤, 现在的wifi无线网使用电磁波等都属于物理层的概念。物理层的能力决定了最大传输速率、传输距离、抗干扰性等. 集线器(Hub)工作在物理层.
- **数据链路层**: 负责设备之间的数据帧的传送和识别. 例如网卡设备的驱动、帧同步(就是说从网线上检测到什么信号算作新帧的开始)、冲突检测(如果检测到冲突就自动重发)、数据差错校验等工作. 有以太网、令牌环网, 无线LAN等标准. 交换机(Switch)工作在数据链路层.
- **网络层**: 负责地址管理和路由选择. 例如在IP协议中, 通过IP地址来标识一台主机, 并通过路由表的方式规划出两台主机之间的数据传输的线路(路由). 路由器(Router)工作在网路层.
- **传输层**: 负责两台主机之间的数据传输. 如传输控制协议 (TCP), 能够确保数据可靠的从源主机发送到目标主机.
- **应用层**: 负责应用程序间沟通，如简单电子邮件传输（SMTP）、文件传输协议（FTP）、网络远程访问协议（Telnet）等. 我们的网络编程主要就是针对应用层.



![在这里插入图片描述](https://img-blog.csdnimg.cn/fa28257b42fd4239a6fb9ff63d9b0035.png)

**站在计算机体系结构看TCP/IP：**

![在这里插入图片描述](https://img-blog.csdnimg.cn/7dc7a97793ef407c975dec1c8ffb4478.png)
物理层我们考虑的比较少. 因此很多时候也可以称为 TCP/IP四层模型.

一般而言
- 对于一台主机, 它的操作系统内核实现了从传输层到物理层的内容;
- 对于一台路由器, 它实现了从网络层到物理层;
- 对于一台交换机, 它实现了从数据链路层到物理层;
- 对于集线器, 它只实现了物理层

---

# 网络传输基本流程





## 网络传输流程图
同一个网段内的两台主机进行文件传输。
![在这里插入图片描述](https://img-blog.csdnimg.cn/c4595f1085b14b5fac22215d5152464e.png)
两台计算机通过TCP/IP协议通讯的过程如下所示：
![在这里插入图片描述](https://img-blog.csdnimg.cn/d99f15dde2d44db08686c4715f90e0ce.png)
**主机A想要发送"hello"消息给主机B，消息数据必须自顶向下封装报头，由以太网驱动程序通过以太网传到另一个以太网驱动程序，再自底向上解包。**

跨网段的主机的文件传输. 数据从一台计算机到另一台计算机传输过程中要经过一个或多个路由器：
![在这里插入图片描述](https://img-blog.csdnimg.cn/05633bfea63c451b8f06431ea7ab775a.png)

---

### 理解报文
**报文 = 报头 + 有效载荷**

**生活角度理解报头：**

![在这里插入图片描述](https://img-blog.csdnimg.cn/9d88f6c1d5ba45cbb76c82700be22f03.png)
**当我们网购时，商家将商品寄给我们时需要将商品包装起来，纸箱贴着快递单，快递单上有收件人收件地址和发件人发件地址，快递单就类似与快递的报头，快递单让我们得知快递需要如何派送，通过网络系统中的报头得知数据是如何发送的。**

---
**Linux C语言角度理解报头：**

**在操作系统中，报头是一个结构化的数据，Linux使用C语言编写的，报头就是一个个的位段，封装的过程就是将报头使用memcpy或者memmove函数拷贝到报文里。解包的过程就是将指向报头的指针强转为(struct header\*)类型进行累加，就实现了解包的过程。**


![在这里插入图片描述](https://img-blog.csdnimg.cn/a0a202054fb3444b9b63b60742bf228e.png)

---


## 数据包封装和分用
- 不同的协议层对数据包有不同的称谓,在传输层叫做段(segment),在网络层叫做数据报 (datagram),在链路层叫做帧(frame).
- 应用层数据通过协议栈发到网络上时,每层协议都要加上一个数据首部(header),称为封装(Encapsulation). 
- 首部信息中包含了一些类似于首部有多长, 载荷(payload)有多长, 上层协议是什么等信息.
- 数据封装成帧后发到传输介质上,到达目的主机后每层协议再剥掉相应的首部, 根据首部中的 "上层协议字段" 将数据交给对应的上层协议处理.

**下图是数据封装的过程：**
![在这里插入图片描述](https://img-blog.csdnimg.cn/6d614548302446e98f0d900a51f8ea17.png)


**下图是数据解包的过程：**
![在这里插入图片描述](https://img-blog.csdnimg.cn/dd5729f4ccc549af81ce1f511cacc1b2.png)





### 协议共性

 - **当前报文的有效载荷要交付给上层的何种协议 --- 分用。**
 - **明确报头和有效载荷的边界 --- 解包。**


---


# 网络中的地址管理

## 认识IP地址
IP协议有两个版本, IPv4和IPv6. 我们整个的课程, 凡是提到IP协议, 没有特殊说明的, 默认都是指IPv4
- IP地址是在IP协议中, 用来标识网络中不同主机的地址;
- 对于IPv4来说, IP地址是一个4字节, 32位的整数;
- 我们通常也使用 "点分十进制" 的字符串表示IP地址, 例如 192.168.0.1 ; 用点分割的每一个数字表示一个
字节, 范围是 0 - 255;
## 认识MAC地址
- MAC地址用来识别数据链路层中相连的节点;
- 长度为48位, 及6个字节. 一般用16进制数字加上冒号的形式来表示(例如: 08:00:27:03:fb:19)
- 在网卡出厂时就确定了, 不能修改. mac地址通常是唯一的(虚拟机中的mac地址不是真实的mac地址, 可能会冲突; 也有些网卡支持用户配置mac地址)

## 局域网通信
同一个局域网内的主机是可以进行通信的。就类似于课堂。
老师叫张三回答问题，老师的这个信息是被所有人听到的，但是只有张三会站起来，为什么？
因为老师叫了张三的名字，张三的名字就类似于Mac地址。
**假设主机B要发送信息给主机C，主机B的报文信息所有的主机都会收到，其他主机解包解析到Mac不是自己，就会丢弃报文。**

**网络资源是被所有主机共享的，如果两个及以上的主机同时发送信息就会发生数据碰撞的问题，所以每一台主机都要有碰撞检测的能力以及碰撞避免算法。**
![在这里插入图片描述](https://img-blog.csdnimg.cn/addf88c7f6aa4d79b3b4569bc017bc06.png)
**网络资源被所以主机所共享，网络资源就是一个临界资源。局域网在任何一个时刻，都只允许一台主机向局域网发送信息。这就等价于"互斥"机制。如果要攻击该局域网，只需要一直占有网络资源这个临界资源，其他主机就会处于"饥饿状态"。**
